<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Подтверждение Email - Dom Falcone</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css?v=6">
    <link rel="icon" href="../assets/images/Falcone-circle.png" type="image/png">
    <style>
        .verification-container {
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .verification-box {
            background: var(--color-surface);
            padding: 3rem;
            border-radius: 20px;
            max-width: 500px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: var(--shadow-lg);
        }
        .spinner {
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .success-icon {
            font-size: 4rem;
            color: #4caf50;
            margin-bottom: 1rem;
        }
        .error-icon {
            font-size: 4rem;
            color: var(--color-primary);
            margin-bottom: 1rem;
        }
        h2 {
            margin-bottom: 1rem;
            color: white;
        }
        p {
            color: var(--color-text-muted);
            margin-bottom: 2rem;
        }
        .btn {
            display: inline-block;
            padding: 14px 32px;
            border-radius: 50px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-decoration: none;
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-glow);
            transition: var(--transition);
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 23, 68, 0.5);
        }
    </style>
</head>
<body>
    <header class="topbar">
    <div class="container topbar-inner">
        <div class="brand">
            <a href="../homepage">
                <div class="logo-mark"
                    style="background: url('../assets/images/Falcone.png') no-repeat center/cover;"></div>
                <span class="brand-title">Dom Falcone</span>
            </a>
        </div>
        
        <!-- Desktop Navigation -->
        <nav class="nav">
            <a href="../about">О доме</a>
            <a href="../history">История</a>
            <a href="../enemies">Противники</a>
            <a href="../news">Новости</a>
        </nav>

        <!-- Burger Menu Button -->
        <div class="burger-menu" id="burger-menu">
            <div class="burger-line"></div>
            <div class="burger-line"></div>
            <div class="burger-line"></div>
        </div>

        <!-- Кнопка "Войти" (показывается когда не авторизован) -->
        <div class="auth-action" id="auth-action" style="display: none;">
            <a href="../login" class="btn-login">Войти</a>
        </div>

        <!-- User Menu (показывается когда авторизован) -->
        <div class="user-menu" id="user-menu" style="display: none;">
            <!-- Кнопка сообщений -->
            <div style="position: relative;">
                <a href="../messages" class="notification-bell" style="text-decoration: none;">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M6,9H18V11H6M14,14H6V12H14M18,8H6V6H18" />
                    </svg>
                    <span class="notification-badge" id="messages-badge" style="display: none;">0</span>
                </a>
            </div>

            <!-- Кнопка уведомлений -->
            <div style="position: relative;">
                <div class="notification-bell" id="notification-bell">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12,22A2,2 0 0,1 10,20H14A2,2 0 0,1 12,22M18,16V11C18,7.93 16.37,5.36 13.5,4.68V4A1.5,1.5 0 0,0 12,2.5A1.5,1.5 0 0,0 10.5,4V4.68C7.63,5.36 6,7.92 6,11V16L4,18V19H20V18L18,16M12,6A5,5 0 0,1 17,11V17H7V11A5,5 0 0,1 12,6Z" />
                    </svg>
                    <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
                </div>

                <!-- Выпадающий список уведомлений -->
                <div class="notifications-dropdown" id="notifications-dropdown">
                    <div class="notifications-header">
                        <h3>Уведомления</h3>
                        <button class="mark-all-read" id="mark-all-read-btn">Прочитать все</button>
                    </div>
                    <div id="notifications-list">
                        <div class="no-notifications">Нет уведомлений</div>
                    </div>
                </div>
            </div>

            <!-- Профиль пользователя -->
            <a href="../dashboard" class="user-profile-info">
                <img src="" alt="Avatar" id="header-avatar" class="header-avatar">
                <div class="user-details">
                    <span class="user-display-name" id="header-display-name">User</span>
                    <div class="user-points-badge">
                        <span>⭐</span>
                        <span id="header-points">0</span>
                    </div>
                </div>
            </a>
        </div>
    </div>
</header>

<!-- Mobile Navigation Overlay -->
<div class="mobile-nav-overlay" id="mobile-nav-overlay"></div>

<!-- Mobile Navigation Menu -->
<nav class="mobile-nav" id="mobile-nav">
    <div class="mobile-nav-links">
        <a href="../about">О доме</a>
        <a href="../history">История</a>
        <a href="../enemies">Противники</a>
        <a href="../news">Новости</a>
        <a href="../dashboard" class="mobile-nav-profile">Профиль</a>
        <a href="../messages" class="mobile-nav-messages">Сообщения</a>
    </div>
    <div class="mobile-nav-footer">
        <div class="site-version"></div>
    </div>
</nav>


    <div class="verification-container">
        <div class="verification-box">
            <div id="loading" style="display: block;">
                <div class="spinner"></div>
                <h2>Проверка токена...</h2>
                <p>Пожалуйста, подождите</p>
            </div>
            
            <div id="success" style="display: none;">
                <div class="success-icon">✓</div>
                <h2>Email подтверждён!</h2>
                <p>Ваш аккаунт успешно активирован. Вы получили бонусные очки за регистрацию!</p>
                <a href="./login" class="btn">Войти в аккаунт</a>
            </div>
            
            <div id="error" style="display: none;">
                <div class="error-icon">✗</div>
                <h2>Ошибка верификации</h2>
                <p id="error-message"></p>
                <a href="../login" class="btn">Вернуться к входу</a>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="container">
            <small>© Dom Falcone 2025. Все права защищены. Прям реально защищены.</small>
        </div>
    </footer>

    <script src="./assets/js/main.js?v=6"></script>
    <script>
        const API_BASE = "https://dom-falcone-auth.dom-falcone-official.workers.dev/api";
        
        async function verifyEmail() {
            const params = new URLSearchParams(window.location.search);
            const token = params.get('token');

            if (!token) {
                showError('Токен верификации не найден в ссылке');
                return;
            }

            try {
                const res = await fetch(API_BASE + "/verify-email?token=" + encodeURIComponent(token));
                const data = await res.json();

                if (res.ok && data.success) {
                    showSuccess(data.message);
                } else {
                    showError(data.error || 'Неверный или истекший токен');
                }
            } catch (err) {
                console.error('Verification error:', err);
                showError('Ошибка подключения к серверу. Попробуйте позже.');
            }
        }

        function showSuccess(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('success').style.display = 'block';
            if (message) {
                document.querySelector('#success p').textContent = message;
            }
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('error-message').textContent = message;
        }

        // Автоматически запускаем верификацию при загрузке
        verifyEmail();
    </script>
    <script src="../assets/js/analytics.js"></script>
</body>
</html>
